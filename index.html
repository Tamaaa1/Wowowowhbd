<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Happy Birthday Nursyahira - Website Ulang Tahun dengan Taman Bunga"
        />
        <title>HBD Nursyahira ðŸŽ‚</title>
        <style>
            /* Loading fallback */
            #root:empty::before {
                content: "Loading...";
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                font-family:
                    system-ui,
                    -apple-system,
                    sans-serif;
                font-size: 1.5rem;
                color: #8fa378;
            }

            /* Basic reset */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                margin: 0;
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
                    "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
                    "Helvetica Neue", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        </style>
    </head>

    <body>
        <div id="root"></div>

        <!-- Background music autoplay -->
        <audio id="bg-audio" class="hidden" loop autoplay>
            <source src="/music/Sempurna.mp3" type="audio/mpeg" />
        </audio>

        <script type="module" src="/src/main.tsx"></script>

        <!-- Error handling script -->
        <script>
            // Catch any runtime errors
            window.addEventListener("error", function (e) {
                console.error("Runtime error:", e.error);
            });

            window.addEventListener("unhandledrejection", function (e) {
                console.error("Unhandled promise rejection:", e.reason);
            });

            // Mobile-friendly audio unlock
            (function () {
                const bgAudio = document.getElementById("bg-audio");
                if (!bgAudio) return;

                bgAudio.volume = 0.25;
                let audioUnlocked = false;

                // Multiple interaction events for mobile
                const events = [
                    "touchstart",
                    "touchend",
                    "mousedown",
                    "click",
                    "keydown",
                ];

                const unlockAudio = function (e) {
                    if (audioUnlocked) return;

                    console.log("ðŸ”“ Attempting audio unlock on:", e.type);

                    // Load and play
                    bgAudio.load();
                    const playPromise = bgAudio.play();

                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => {
                                console.log("âœ… Audio unlocked and playing!");
                                audioUnlocked = true;

                                // Remove all event listeners
                                events.forEach((event) => {
                                    document.removeEventListener(
                                        event,
                                        unlockAudio,
                                    );
                                    window.removeEventListener(
                                        event,
                                        unlockAudio,
                                    );
                                    document.body.removeEventListener(
                                        event,
                                        unlockAudio,
                                    );
                                });
                            })
                            .catch((err) => {
                                console.log("âš ï¸ Play failed:", err.message);
                                // Keep trying on next interaction
                            });
                    }
                };

                // Attach to multiple elements for better mobile coverage
                events.forEach((event) => {
                    document.addEventListener(event, unlockAudio);
                    window.addEventListener(event, unlockAudio);
                    document.body.addEventListener(event, unlockAudio);
                });

                // Try immediate play (works on desktop)
                const immediatePlay = bgAudio.play();
                if (immediatePlay !== undefined) {
                    immediatePlay
                        .then(() => {
                            console.log("ðŸŽµ Autoplay successful!");
                            audioUnlocked = true;
                        })
                        .catch(() => {
                            console.log(
                                "âš ï¸ Autoplay blocked, waiting for gesture",
                            );
                        });
                }

                // Force play on page visibility change (mobile resume)
                document.addEventListener("visibilitychange", () => {
                    if (!document.hidden && bgAudio.paused) {
                        bgAudio.play().catch(() => {});
                    }
                });
            })();
        </script>
    </body>
</html>
